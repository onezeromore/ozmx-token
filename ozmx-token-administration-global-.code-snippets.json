{"generator":"Code Snippets v3.4.2.2","date_created":"2023-09-11 23:28","snippets":[{"id":44,"name":"OZMX Token Administration Global ","desc":"<p><strong>Der Code enth\u00e4lt die Integration von OZMX-Token in eine WooCommerce-Website. Hier sind die Hauptfunktionen und ihre Beschreibungen:<\/strong> \n<br \/>1. **Globale Einstellungen initialisieren**: Zu Beginn des Codes werden einige globale Einstellungen initialisiert, die den Gesamtbestand an OZMX-Token und die Anzahl der generierten und \u00fcbertragenen Token speichern. \n<br \/>2. **Neuen Endpunkt f\u00fcr das Benutzerprofil registrieren**: Ein neuer Endpunkt namens \"ozmx_token\" wird f\u00fcr das Benutzerprofil in WooCommerce registriert. \n<br \/>3. **Benutzerdefiniertes Feld zur WooCommerce-Kontoseite hinzuf\u00fcgen**: Ein benutzerdefiniertes Feld wird zur Kontoseite hinzugef\u00fcgt, das es den Benutzern erm\u00f6glicht, ihre BRC-20-Token-Wallet-Adresse einzugeben und zu aktualisieren. \n<br \/>4. **Benutzerdefinierten Tab zur WooCommerce-Kontomen\u00fc hinzugef\u00fcgen**: Ein neuer Tab namens \"OZMX Token\" wird zum Kontomen\u00fc hinzugef\u00fcgt. \n<br \/>5. **Token Generierung bei Kaufabschluss**: Wenn eine Bestellung abgeschlossen wird, werden OZMX-Token basierend auf dem Bestellwert generiert und dem Benutzerkonto gutgeschrieben. \n<br \/>6. **Token-R\u00fcckbuchung bei Stornierung der Bestellung**: Wenn eine Bestellung storniert wird, werden die zuvor generierten Token vom Benutzerkonto abgebucht. \n<br \/>7. **Token \u00dcbertragung an Benutzer**: Eine Funktion, die es erm\u00f6glicht, Token an einen bestimmten Benutzer zu \u00fcbertragen. \n<br \/>8. **Neuen Men\u00fcpunkt im Adminbereich hinzuf\u00fcgen**: Ein neuer Men\u00fcpunkt namens \"OZMX\" wird zum WordPress-Adminbereich hinzugef\u00fcgt, der es den Administratoren erm\u00f6glicht, den Tokenstand und die Wallet-Adressen der Benutzer zu \u00fcberpr\u00fcfen. \n<br \/>9. **Token-Transfer-Handler**: Eine Funktion, die den Token-Transfer von einem Benutzerkonto zu seiner externen Wallet behandelt.\n<br \/>10. **Anzeige von Transaktionen in umgekehrter Reihenfolge**: Die Transaktionen in \"OZMX Doku \/ OZMX Token Transaktionsdokumentation\" werden nun so angezeigt, dass die aktuellsten Eintr\u00e4ge oben stehen.\n<br \/>11. **Kontrollk\u00e4stchen \"An eine andere Adresse liefern\" und \"Create an account\" auf der Checkout-Seite**.<\/p>","code":"\/\/ Name: OZMX Token Global Integration 1.0.3\n\/\/ Globale Einstellungen initialisieren Woocoomerce 8.0.2\n\n\/\/ Register a new endpoint for the user profile\nadd_action('init', 'register_ozmx_token_endpoint');\nfunction register_ozmx_token_endpoint() {\n    add_rewrite_endpoint('ozmx_token', EP_ROOT | EP_PAGES);\n}\n\n\/\/ This function should be called once, e.g., on theme or plugin activation.\nfunction ozmx_flush_rewrite_rules() {\n    flush_rewrite_rules(false); \/\/ Flush the rules, but do not hard flush (false)\n}\nregister_activation_hook(__FILE__, 'ozmx_flush_rewrite_rules');\n\n\/\/ Add the custom field to the WooCommerce account page\nadd_action('woocommerce_account_ozmx_token_endpoint', 'add_ozmx_token_content');\nfunction add_ozmx_token_content() {\n    $user_id = get_current_user_id();\n    $wallet_address = get_user_meta($user_id, 'brc20_wallet_address', true);\n    $understood = get_user_meta($user_id, 'understood', true);\n    $transfer_to_external_wallet = get_user_meta($user_id, 'transfer_to_external_wallet', true); \/\/ Neues Meta-Feld\n\n    if ($_SERVER['REQUEST_METHOD'] === 'POST') {\n        if (isset($_POST['brc20_wallet_address'])) {\n            $wallet_address = sanitize_text_field($_POST['brc20_wallet_address']);\n            update_user_meta($user_id, 'brc20_wallet_address', $wallet_address);\n            echo '<div class=\"woocommerce-message\">' . __('Wallet address updated successfully!', 'my-child-theme') . '<\/div>';\n        }\n        if (isset($_POST['understood'])) {\n            update_user_meta($user_id, 'understood', 1);\n        } else {\n            update_user_meta($user_id, 'understood', 0);\n        }\n\t\t     if (isset($_POST['transfer_to_external_wallet'])) {\n            update_user_meta($user_id, 'transfer_to_external_wallet', 1);\n        } else {\n            update_user_meta($user_id, 'transfer_to_external_wallet', 0);\n        }\n    }\n\n    echo '<form method=\"post\">';\n\t\techo '<input type=\"submit\" value=\"' . __('Update Wallet', 'my-child-theme') . '\" class=\"button\" \/>';\n    echo '<img width=\"80\" height=\"80\" src=\"https:\/\/onezeromore.com\/wp-content\/uploads\/2023\/06\/OZMX_Token_Weissx-150x150.jpg \">';\n    $user_tokens = floatval(get_user_meta($user_id, 'ozmx_user_tokens', true));\n    echo ' ' . number_format($user_tokens, 0, ',', '.') . ' ' . __('Aktueller OZMX Tokenstand', 'my-child-theme');\n    echo '<br><p style=\"text-align: justify;\">' . __('Der OZMX Token repr\u00e4sentiert ein <a href=\"https:\/\/onezeromore.com\/vertrauenskonzept\/\">innovatives<\/a> und experimentelles Konzept innerhalb der Community des OZM. Als Community Token wurde es mit der Absicht geschaffen, die Verbindung und das Engagement innerhalb der Kunstliebhaber und Unterst\u00fctzer zu f\u00f6rdern. Es ist wichtig zu betonen, dass der OZMX Token keinen monet\u00e4ren Wert besitzt und nicht als Investition oder Spekulationsinstrument betrachtet werden sollte. Sein Wert liegt vielmehr in seiner symbolischen Bedeutung und der M\u00f6glichkeit, eine neue Form des Dialogs und der Zusammenarbeit in der Kunstwelt zu erm\u00f6glichen. Es verk\u00f6rpert den Geist der Innovation und Kreativit\u00e4t, der das OZM auszeichnet, und l\u00e4dt alle ein, Teil dieser aufregenden k\u00fcnstlerischen Reise zu sein.', 'my-child-theme') . '<\/p>';\n\t  echo '<p><label for=\"understood\"><input type=\"checkbox\" name=\"understood\" id=\"understood\" value=\"1\" ' . checked(1, $understood, false) . ' \/> ' . __('Ich habe den Text gelesen und verstanden', 'my-child-theme') . '<\/label><\/p>';\n\t  echo '<p><label for=\"brc20_wallet_address\">' . __('Deine BRC-20 Token Wallet Address:', 'my-child-theme') . ' <\/label>';\n   echo '<input type=\"text\" name=\"brc20_wallet_address\" id=\"brc20_wallet_address\" value=\"' . esc_attr($wallet_address) . '\" class=\"input-text\" \/><\/p>';\n\t echo '<p><label for=\"transfer_to_external_wallet\"><input type=\"checkbox\" name=\"transfer_to_external_wallet\" id=\"transfer_to_external_wallet\" value=\"1\" ' . checked(1, $transfer_to_external_wallet, false) . ' \/> ' . __('OZMX Token auf externe Wallet \u00fcbertragen', 'my-child-theme') . '<\/label><\/p>';\n    echo '<\/form>';\n}\n\n\/\/ Add the custom tab to the WooCommerce account menu\nadd_filter('woocommerce_account_menu_items', 'ozmx_token_tab');\nfunction ozmx_token_tab($menu_links) {\n    $menu_links = array_slice($menu_links, 0, 1, true)\n    + array('ozmx_token' => __('OZMX Token', 'my-child-theme'))\n    + array_slice($menu_links, 1, NULL, true);\n    return $menu_links;\n}\n\n\/\/ Token Generierung bei Kaufabschluss\nfunction generate_ozmx_tokens($order_id) {\n    \/\/ \u00dcberpr\u00fcfen Sie, ob Tokens bereits f\u00fcr diese Bestellung generiert wurden\n    if (get_post_meta($order_id, '_ozmx_tokens_generated', true)) {\n        return; \/\/ Beenden Sie die Funktion, wenn Tokens bereits generiert wurden\n    }\n\n    $order = wc_get_order($order_id);\n    $items = $order->get_items();\n    $total_tokens_to_generate = 0;\n\n    foreach ($items as $item) {\n           $product = $item->get_product();\n   \t\t\t $total = $item->get_total();\n\n\/\/ \u00dcberpr\u00fcfen Sie, ob das Produkt oder sein \u00fcbergeordnetes Produkt (falls es ein variables Produkt ist) die has_OZMID-Bedingung erf\u00fcllt\n    if (has_OZMID($product) || ( $product->is_type('variation') && has_OZMID(wc_get_product($product->get_parent_id())) )) {\n        if (is_numeric($total)) {\n            $total_tokens_to_generate += floor(floatval($total) * 0.10);\n        }\n    }\n}\n\n    $generated_tokens = intval(get_option('ozmx_generated_tokens', 0));\n    $total_tokens = intval(get_option('ozmx_total_tokens', 0));\n\n    update_option('ozmx_generated_tokens', $generated_tokens + $total_tokens_to_generate); \n\n    $user_id = $order->get_user_id();\n\n    if ($user_id) { \/\/ \u00dcberpr\u00fcfen, ob es sich um einen registrierten Benutzer handelt\n        $wallet_address = get_user_meta($user_id, 'brc20_wallet_address', true);\n\n        if ($wallet_address) { \/\/ \u00dcberpr\u00fcfen, ob der Benutzer eine Wallet-Adresse hat\n            $user_tokens = floatval(get_user_meta($user_id, 'ozmx_user_tokens', true));\n            update_user_meta($user_id, 'ozmx_user_tokens', $user_tokens + $total_tokens_to_generate);\n        } else {\n            \/\/ Wenn der Benutzer keine Wallet-Adresse hat\n            $user_tokens = floatval(get_user_meta($user_id, 'ozmx_user_tokens', true));\n            update_user_meta($user_id, 'ozmx_user_tokens', $user_tokens + $total_tokens_to_generate);\n        }\n    } else {\n        \/\/ Wenn es sich um eine G\u00e4stebestellung handelt\n        $guest_tokens = get_option('ozmx_guest_tokens');\n        update_option('ozmx_guest_tokens', $guest_tokens + $total_tokens_to_generate);\n    }\n\n    \/\/ Nachdem die Tokens generiert wurden, setzen Sie die Metadaten-Flag f\u00fcr diese Bestellung\n\tupdate_post_meta($order_id, '_ozmx_tokens_generated', 'yes');\n\n\t\/\/ Token-Transaktionshistorie des Benutzers aktualisieren\n\t$transfers = get_user_meta($user_id, 'token_transfers', true);\n\tif (!is_array($transfers)) {\n    $transfers = [];\n\t}\n\t$transfers[] = ['date' => current_time('mysql'), 'amount' => $total_tokens_to_generate, 'status' => __('Token generiert', 'my-child-theme')];\n\tupdate_user_meta($user_id, 'token_transfers', $transfers);\n}\n\nadd_action('woocommerce_order_status_completed', 'generate_ozmx_tokens');\n\n\/\/ Token-R\u00fcckbuchung bei Stornierung der Bestellung\nfunction refund_ozmx_tokens_on_cancellation($order_id) {\n    $order = wc_get_order($order_id);\n    $user_id = $order->get_user_id();\n    \n    if (!$user_id) {\n        error_log(\"OZMX: Keine Benutzer-ID f\u00fcr Bestellung $order_id gefunden.\");\n        return;\n    }\n\n    $tokens_to_refund = floatval($order->get_subtotal()) * 0.10;\n\n    \/\/ Benutzer-Token-Werte aktualisieren\n    $user_tokens = floatval(get_user_meta($user_id, 'ozmx_user_tokens', true));\n    $user_tokens -= $tokens_to_refund;\n    update_user_meta($user_id, 'ozmx_user_tokens', $user_tokens);\n\n\/\/ Globale Token-Werte aktualisieren\n$generated_tokens = intval(get_option('ozmx_generated_tokens', 0));\n$total_tokens = intval(get_option('ozmx_total_tokens', 0));\n\nupdate_option('ozmx_generated_tokens', $generated_tokens - $tokens_to_refund);\nupdate_option('ozmx_total_tokens', $total_tokens + $tokens_to_refund); \/\/ das zweite mal\n\n\/\/ Token-Transaktionshistorie des Benutzers aktualisieren\n$transfers = get_user_meta($user_id, 'token_transfers', true);\nif (!is_array($transfers)) {\n    $transfers = [];\n}\n$transfers[] = ['date' => current_time('mysql'), 'amount' => -$tokens_to_refund, 'status' => __('Token wegen Stornierung zur\u00fcckgegeben', 'my-child-theme')];\nupdate_user_meta($user_id, 'token_transfers', $transfers);\n}\nadd_action('woocommerce_order_status_cancelled', 'refund_ozmx_tokens_on_cancellation');\n\n\/\/ Token \u00dcbertragung an Benutzer\nfunction transfer_ozmx_tokens_to_user($user_id, $amount) {\n   $user_tokens = floatval(get_user_meta($user_id, 'ozmx_user_tokens', true));\n    update_user_meta($user_id, 'ozmx_user_tokens', $user_tokens + $amount);\n}\n\n\/\/ Erstellen Sie einen neuen Men\u00fcpunkt im Adminbereich Woocoomerce 8.0.2\nadd_action('admin_menu', 'ozmx_admin_menu');\nfunction ozmx_admin_menu() {\n    add_menu_page(__('OZMX', 'my-child-theme'), __('OZMX', 'my-child-theme'), 'manage_options', 'ozmx', 'ozmx_admin_page', 'dashicons-tickets', 6);\n    add_submenu_page('ozmx', __('OZMX Wallets', 'my-child-theme'), __('OZMX Wallets', 'my-child-theme'), 'manage_options', 'ozmx-custom-fields', 'ozmx_custom_fields_page');\n    add_submenu_page('ozmx', __('OZMX ohne Wallet', 'my-child-theme'), __('OZMX ohne Wallet', 'my-child-theme'), 'manage_options', 'ozmx-no-wallet', 'ozmx_no_wallet_page');\n add_submenu_page('ozmx', __('OZMX Doku', 'my-child-theme'), __('OZMX Doku', 'my-child-theme'), 'manage_options', 'ozmx-doku', 'ozmx_doku_page');\n\n\n}\n\n\/\/ Hauptseite des OZMX-Men\u00fcs\n\/\/    Token \u00dcbertragung aller Benutzer an ihr Wallet\nfunction get_total_transferred_tokens_for_all_users() {\n    $users = get_users();\n    $total_transferred_tokens = 0;\n\n    foreach ($users as $user) {\n        $user_transferred_tokens = get_user_meta($user->ID, 'ozmx_transferred_tokens', true);\n        $total_transferred_tokens += intval($user_transferred_tokens);\n    }\n\n    return $total_transferred_tokens;\n}\n\nfunction ozmx_admin_page() {\n    $total_tokens = get_option('ozmx_total_tokens', 420000000);\n    $generated_tokens = get_option('ozmx_generated_tokens', 0);\n\t$total_transferred_tokens_for_all_users = get_total_transferred_tokens_for_all_users();\n\t $guest_tokens = get_option('ozmx_guest_tokens', 0);\n\t echo '<h2>' . __('Tokens f\u00fcr G\u00e4stebestellungen', 'my-child-theme') . '<\/h2>';\n\techo '<p>' . sprintf(__('Es wurden %s Tokens f\u00fcr G\u00e4stebestellungen generiert.', 'my-child-theme'), number_format(floatval($guest_tokens), 0, ',', '.')) . '<\/p>';\n \/\/   $transferred_tokens = get_option('ozmx_transferred_tokens', 0); wird nicht gebraucht\n\n    echo '<h1>' . __('OZMX Adminbereich', 'my-child-theme') . '<\/h1>';\n    echo '<table class=\"wp-list-table widefat fixed striped\">';\n    echo '<thead>';\n    echo '<tr>';\n    echo '<th>' . __('Gesamtzahl aller Token', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Generierte Token', 'my-child-theme') . '<\/th>';\n\techo '<th>' . __('\u00dcbertragenen Token', 'my-child-theme') . '<\/th>';\n    echo '<\/tr>';\n    echo '<\/thead>';\n    echo '<tbody>';\n    echo '<tr>';\n    echo '<td>' . number_format($total_tokens - $generated_tokens, 0, ',', '.') . '<\/td>'; \/\/ Abz\u00fcglich der generierten Token\n    echo '<td>' . number_format($generated_tokens, 0, ',', '.') . '<\/td>';\n\techo '<td>' . number_format($total_transferred_tokens_for_all_users, 0, ',', '.') . '<\/td>';\n    echo '<\/tr>';\n    echo '<\/tbody>';\n    echo '<\/table>';\n\t\n\t\n    \/\/ Liste aller Produktkategorien mit OZMID und der Option, OZMX-Token zu generieren\n    echo '<h2>' . __('OZMID Kategorien', 'my-child-theme') . '<\/h2>';\n    $categories = get_terms('product_cat', array('hide_empty' => false));\n    echo '<table class=\"wp-list-table widefat fixed striped\">';\n    echo '<thead>';\n    echo '<tr>';\n    echo '<th>' . __('Kategorie', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('OZMID', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('OZMX-Token generieren?', 'my-child-theme') . '<\/th>';\n    echo '<\/tr>';\n    echo '<\/thead>';\n    echo '<tbody>';\n    foreach ($categories as $category) {\n        $OZMID = get_term_meta($category->term_id, 'OZMID', true);\n        $generate_ozmx = get_term_meta($category->term_id, 'generate_ozmx', true);\n        echo '<tr>';\n        echo '<td>' . esc_html($category->name) . '<\/td>';\n        echo '<td>' . esc_html($OZMID) . '<\/td>';\n        echo '<td>' . ($generate_ozmx ? __('Ja', 'my-child-theme') : __('Nein', 'my-child-theme')) . '<\/td>';\n        echo '<\/tr>';\n    }\n    echo '<\/tbody>';\n    echo '<\/table>';\n}\n\n\n\/\/ Unterseite f\u00fcr OZMX Wallets\nfunction ozmx_custom_fields_page() {\n    echo '<h2>' . __('Token Wallets', 'my-child-theme') . '<\/h2>';\n\n    $args = array(\n        'meta_key' => 'brc20_wallet_address',\n        'meta_value' => '',\n        'meta_compare' => '!=',\n        'fields' => 'all_with_meta'\n    );\n    $users = get_users($args);\n\n    echo '<table class=\"wp-list-table widefat fixed striped\">';\n    echo '<thead>';\n    echo '<tr>';\n    echo '<th>' . __('Name', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Wallet Address', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Verstanden', 'my-child-theme') . '<\/th>';\n\t echo '<th>' . __('Token auf externe Wallet \u00fcbertragen?', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Aktueller OZMX Tokenstand', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Ausgezahlter Tokenstand', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Aktion', 'my-child-theme') . '<\/th>';\n    echo '<\/tr>';\n    echo '<\/thead>';\n    echo '<tbody>';\n\nforeach ($users as $user) {\n    $user_tokens = floatval(get_user_meta($user->ID, 'ozmx_user_tokens', true));\n    $transferred_tokens = floatval(get_user_meta($user->ID, 'ozmx_transferred_tokens', true));\n    $transfer_to_external_wallet = get_user_meta($user->ID, 'transfer_to_external_wallet', true); \/\/ Hinzuf\u00fcgen dieser Zeile\n    $nonce = wp_create_nonce('transfer_tokens_nonce_' . $user->ID); \/\/ Nonce erstellen\n\n    echo '<tr>';\n    echo '<td><a href=\"' . get_edit_user_link($user->ID) . '\">' . esc_html($user->display_name) . '<\/a><\/td>';\n    echo '<td>' . esc_html($user->brc20_wallet_address) . '<\/td>';\n    echo '<td>' . ($user->understood ? __('Ja', 'my-child-theme') : __('Nein', 'my-child-theme')) . '<\/td>';\n    echo '<td>' . ($transfer_to_external_wallet ? __('Ja', 'my-child-theme') : __('Nein', 'my-child-theme')) . '<\/td>'; \/\/ Verwendung der Variable hier\n \techo '<td>' . number_format(floatval($user_tokens), 0, ',', '.') . '<\/td>';\n \techo '<td>' . number_format(floatval($transferred_tokens), 0, ',', '.') . '<\/td>';\n    echo '<td>';\n    echo '<form action=\"' . admin_url('admin-post.php') . '\" method=\"post\">';\n    echo '<input type=\"hidden\" name=\"action\" value=\"transfer_tokens_to_wallet\">';\n    echo '<input type=\"hidden\" name=\"user_id\" value=\"' . $user->ID . '\">';\n    echo '<input type=\"hidden\" name=\"nonce\" value=\"' . $nonce . '\">';\n    echo '<input type=\"submit\" value=\"' . __('Token \u00fcbertragen', 'my-child-theme') . '\">';\n    echo '<\/form>';\n    echo '<\/td>';\n    echo '<\/tr>';\n}\n\n    echo '<\/tbody>';\n    echo '<\/table>';\n}\n\n\/\/ Unterseite f\u00fcr OZMX ohne Wallet\nfunction ozmx_no_wallet_page() {\n    echo '<h2>' . __('Benutzer ohne Wallet', 'my-child-theme') . '<\/h2>';\n    $args = array(\n        'meta_key' => 'brc20_wallet_address',\n        'meta_value' => '',\n        'meta_compare' => '=',\n        'fields' => 'all_with_meta'\n    );\n    $users_without_wallet = get_users($args);\n\n    echo '<table class=\"wp-list-table widefat fixed striped\">';\n    echo '<thead>';\n    echo '<tr>';\n    echo '<th>' . __('Name', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('E-Mail', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Registrierungsdatum', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Tokenstand', 'my-child-theme') . '<\/th>';  \/\/ Neue Spalte f\u00fcr den Tokenstand\n    echo '<\/tr>';\n    echo '<\/thead>';\n    echo '<tbody>';\n\n    foreach ($users_without_wallet as $user) {\n        $user_tokens = get_user_meta($user->ID, 'ozmx_user_tokens', true);  \/\/ Tokenstand des Benutzers abrufen\n        echo '<tr>';\n        echo '<td><a href=\"' . get_edit_user_link($user->ID) . '\">' . esc_html($user->display_name) . '<\/a><\/td>';\n        echo '<td>' . esc_html($user->user_email) . '<\/td>';\n        echo '<td>' . date_i18n(get_option('date_format'), strtotime($user->user_registered)) . '<\/td>';\n\t\techo '<td>' . number_format(floatval($user_tokens), 0, ',', '.') . '<\/td>';  \/\/ Tokenstand des Benutzers anzeigen\n        echo '<\/tr>';\n    }\n\n    echo '<\/tbody>';\n    echo '<\/table>';\n}\n\/\/ Hauptseite des OZMX Doku-Men\u00fcs\nfunction ozmx_doku_page() {\n    echo '<h2>' . __('OZMX Token Transaktionsdokumentation', 'my-child-theme') . '<\/h2>';\n\n    \/\/ Abfrage aller Benutzer, die OZMX Token-Transaktionen hatten\n    $args = array(\n        'meta_key' => 'token_transfers',\n        'meta_value' => '',\n        'meta_compare' => '!=',\n        'fields' => 'all_with_meta'\n    );\n    $users_with_transfers = get_users($args);\n\n    echo '<table class=\"wp-list-table widefat fixed striped\">';\n    echo '<thead>';\n    echo '<tr>';\n    echo '<th>' . __('Name', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Datum', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Menge', 'my-child-theme') . '<\/th>';\n    echo '<th>' . __('Status', 'my-child-theme') . '<\/th>';\n    echo '<\/tr>';\n    echo '<\/thead>';\n    echo '<tbody>';\n\n    foreach ($users_with_transfers as $user) {\n        $transfers = get_user_meta($user->ID, 'token_transfers', true);\n          \/\/ Umkehren der Reihenfolge der Transaktionen\n    $transfers = array_reverse($transfers);\n    foreach ($transfers as $transfer) {\n            echo '<tr>';\n            echo '<td><a href=\"' . get_edit_user_link($user->ID) . '\">' . esc_html($user->display_name) . '<\/a><\/td>';\n            echo '<td>' . esc_html($transfer['date']) . '<\/td>';\n            echo '<td>' . number_format(floatval($transfer['amount']), 0, ',', '.') . '<\/td>';\n            echo '<td>' . esc_html($transfer['status']) . '<\/td>';\n            echo '<\/tr>';\n        }\n    }\n\n    echo '<\/tbody>';\n    echo '<\/table>';\n}\n\n\n\/\/ Verarbeiten der Token-\u00dcbertragung\nadd_action('admin_post_transfer_tokens_to_wallet', 'handle_token_transfer');\nfunction handle_token_transfer() {\n    $user_id = intval($_POST['user_id']);\n    if (!isset($_POST['nonce']) || !wp_verify_nonce($_POST['nonce'], 'transfer_tokens_nonce_' . $user_id) || !current_user_can('manage_options')) {\n        wp_die(__('Sicherheits\u00fcberpr\u00fcfung fehlgeschlagen.', 'my-child-theme'));\n    }\n    $transferred_amount = floatval(get_user_meta($user_id, 'ozmx_user_tokens', true));\n\n    \/\/ Token-Guthaben des Benutzers zur\u00fccksetzen\n    update_user_meta($user_id, 'ozmx_user_tokens', 0);\n\n    \/\/ Gesamtzahl der \u00fcbertragenen Token aktualisieren\n    $total_transferred = floatval(get_user_meta($user_id, 'ozmx_transferred_tokens', true));\n    $total_transferred += $transferred_amount;\n    update_user_meta($user_id, 'ozmx_transferred_tokens', $total_transferred);\n\n    \/\/ Weiterleitung zur\u00fcck zur Wallet-Seite mit einer Erfolgsmeldung\n    wp_redirect(admin_url('admin.php?page=ozmx-custom-fields&transfer=success'));\n    exit;\n}\n\/\/ Kontrollk\u00e4stchen \"An eine andere Adresse liefern\" auf der Checkout-Seite\nadd_filter('woocommerce_ship_to_different_address_checked', '__return_false');\n\/\/ Create an account\nadd_filter('woocommerce_create_account_default_checked', '__return_true');\nadd_filter('gettext', 'customize_create_account_text', 999, 3);\nfunction customize_create_account_text($translated_text, $text, $domain) {\n    if ($text === 'Create an account?' && $domain === 'woocommerce') {\n        $translated_text = 'Create an account? Halte OZMX Token!';\n    }\n    return $translated_text;\n}","active":true,"modified":"2023-09-11 23:27:10"}]}